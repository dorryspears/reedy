# Progress Log

## 2026-01-12

### Fixed: High Bug #5 - Favorites View Not Updated on Unfavorite

**Location:** `src/app.rs:866-893`

**Problem:** When unfavoriting an item while in Favorites view, the item remained visible until the user manually refreshed or toggled the view. This was confusing UX.

**Solution:**
1. Modified `toggle_favorite()` to track whether the item was a favorite before toggling
2. After unfavoriting, if in Favorites view (`PageMode::Favorites`), the item is immediately removed from `current_feed_content`
3. The `selected_index` is adjusted appropriately:
   - If the list becomes empty, `selected_index` is set to `None`
   - If the removed item was at the end, `selected_index` moves to the new last item
   - Otherwise, `selected_index` stays the same (now pointing to the next item)

**Files changed:**
- `src/app.rs` - Modified `toggle_favorite()` to remove unfavorited items from view in Favorites mode
- `tests/app_tests.rs` - Added 3 new tests:
  - `test_unfavorite_removes_from_favorites_view` - verifies item removal and index adjustment
  - `test_unfavorite_last_item_in_favorites_view` - verifies empty list handling
  - `test_unfavorite_does_not_remove_in_feedlist_view` - verifies behavior unchanged in normal view

**Tests:** All tests pass (16 total: 11 app tests, 5 ui tests)

---

### Fixed: High Bug #4 - No HTTP Request Timeouts

**Location:** `src/app.rs` - multiple locations using `reqwest::get()`

**Problem:** All HTTP requests using `reqwest::get()` lacked timeout configuration. When a feed server was slow or unresponsive, the application would hang indefinitely waiting for a response.

**Solution:**
1. Added a `create_http_client()` helper function that creates a `reqwest::Client` with a 30-second timeout
2. Replaced all bare `reqwest::get()` calls with client-based requests using the new helper
3. Added `Duration` to the imports for timeout configuration

**Files changed:**
- `src/app.rs` - Added `create_http_client()` function and updated 5 locations:
  - `is_valid_rss_feed()`
  - `load_feed_content()`
  - `cache_all_feeds()`
  - `refresh_all_feeds()`
  - `fetch_feed()`

**Tests:** All tests pass (13 total: 8 app tests, 5 ui tests)

### Fixed: High Bug #3 - Cache Cleared on Every Startup

**Location:** `src/app.rs:103`

**Problem:** `clear_cache_dir()` was called unconditionally in `App::new()` on every startup, which deleted all cached feed data. This defeated the purpose of caching for offline reading and forced users to wait for feeds to reload every time.

**Solution:** Removed the `clear_cache_dir()` call from `App::new()`. The existing cache system already has proper 1-hour TTL expiration logic in `load_feed_cache()`, making the startup cache clear unnecessary. Also removed the now-unused `clear_cache_dir()` function to avoid dead code.

**Files changed:**
- `src/app.rs` - Removed `clear_cache_dir()` call from `App::new()` and removed the unused `clear_cache_dir()` function

**Tests:** All tests pass (13 total: 8 app tests, 5 ui tests)

### Fixed: Critical Bug #2 - Integer Underflow in `truncate_text`

**Location:** `src/ui.rs:346-361`

**Problem:** When `max_width < 3`, the subtraction `(max_width - 3) as usize` would cause integer underflow, leading to potential panic or unexpected behavior when the terminal is very narrow.

**Solution:** Added an early return guard at the beginning of `truncate_text()` that checks if `max_width < 3`. When true, it returns the text truncated to `max_width` characters without attempting to add ellipsis.

**Files changed:**
- `src/ui.rs` - Added guard for small width values
- `tests/ui_tests.rs` - Added test `test_truncate_text_very_small_width` covering edge cases for width 0, 1, 2, and 3

**Tests:** All tests pass (8 total: 4 app tests, 5 ui tests including new edge case test)

### Fixed: Critical Bug #1 - Panic on Empty List Navigation

**Location:** `src/app.rs:285`, `src/app.rs:296`

**Problem:** `select_previous()` and `select_next()` could panic when navigating an empty list:
- `(current + 1) % len` causes division by zero when `len == 0`
- `len - 1` causes integer underflow when `len == 0`

**Solution:** Added early return guard `if len == 0 { return; }` in both `select_previous()` and `select_next()` functions before any arithmetic operations on `len`.

**Files changed:**
- `src/app.rs` - Added empty list guard in `select_previous()` and `select_next()`
- `tests/app_tests.rs` - Added 4 new tests covering empty list navigation edge cases:
  - `test_select_next_empty_list`
  - `test_select_previous_empty_list`
  - `test_select_next_empty_feed_manager`
  - `test_select_previous_empty_feed_manager`

**Tests:** All tests pass (13 total: 8 app tests, 5 ui tests)
